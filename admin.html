<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ø²ÙŠØ²Ùˆ ÙˆØ¨Ù„Ø§Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --dark: #1a1a2e;
            --darker: #16213e;
            --burgundy: #722F37;
            --text: #f5f5f5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            padding: 20px;
            border-bottom: 2px solid var(--gold);
            margin-bottom: 30px;
        }

        header h1 {
            color: var(--gold);
            font-size: 1.8rem;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: var(--darker);
            border: 1px solid var(--gold);
            color: var(--gold);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab:hover,
        .tab.active {
            background: var(--gold);
            color: var(--dark);
        }

        .panel {
            display: none;
            background: var(--darker);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .panel.active {
            display: block;
        }

        .panel h2 {
            color: var(--gold);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--gold);
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gold);
            border-radius: 8px;
            background: var(--dark);
            color: var(--text);
            font-family: inherit;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: var(--gold);
            color: var(--dark);
        }

        .btn-primary:hover {
            background: #e6c547;
        }

        .btn-danger {
            background: var(--burgundy);
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--dark);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid rgba(212, 175, 55, 0.1);
            flex-wrap: wrap;
            gap: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--gold);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            color: var(--gold);
        }

        .stat-card p {
            color: #999;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .badge-success {
            background: #2ecc71;
            color: white;
        }

        .badge-warning {
            background: #f39c12;
            color: white;
        }

        .badge-draft {
            background: #95a5a6;
            color: white;
        }

        .section-card {
            background: var(--dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--gold);
        }

        .section-card h4 {
            color: var(--gold);
            margin-bottom: 10px;
        }

        .content-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--gold);
        }

        @media (max-width: 600px) {
            .tabs {
                flex-direction: column;
            }

            .tab {
                text-align: center;
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="container">
            <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ù…Ù†ØµØ© Ø²ÙŠØ²Ùˆ ÙˆØ¨Ù„Ø§Ù„</h1>
            <small style="color:#999">Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© (localStorage) - Ù„Ø§ ØªØ­ØªØ§Ø¬ Ø³ÙŠØ±ÙØ±</small>
        </div>
    </header>

    <div class="container">
        <div class="stats">
            <div class="stat-card">
                <h3 id="sectionsCount">0</h3>
                <p>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</p>
            </div>
            <div class="stat-card">
                <h3 id="sheikhsCount">0</h3>
                <p>Ø§Ù„Ø´ÙŠÙˆØ®</p>
            </div>
            <div class="stat-card">
                <h3 id="lessonsCount">0</h3>
                <p>Ø§Ù„Ø¯Ø±ÙˆØ³</p>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('sections')">ğŸ“š Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
            <button class="tab" onclick="showTab('sheikhs')">ğŸ‘¤ Ø§Ù„Ø´ÙŠÙˆØ®</button>
            <button class="tab" onclick="showTab('lessons')">ğŸ“– Ø§Ù„Ø¯Ø±ÙˆØ³</button>
            <button class="tab" onclick="showTab('addLesson')">â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³</button>
            <button class="tab" onclick="showTab('preview')">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
        </div>

        <!-- Sections Panel -->
        <div id="sections" class="panel active">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©)</h2>
            <div class="alert">
                â„¹ï¸ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© - ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø­Ø°Ù Ø£ÙŠ Ù‚Ø³Ù… Ù…Ù† Ù‡Ù†Ø§
            </div>
            <button class="btn btn-primary" onclick="seedSections()">ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
            <hr style="margin: 20px 0; border-color: var(--gold)">

            <div class="form-group">
                <label>Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</label>
                <div style="display:flex; gap:10px; flex-wrap:wrap">
                    <input type="text" id="newSectionName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ" style="flex:1">
                    <input type="text" id="newSectionIcon" placeholder="Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ğŸ“–" style="width:80px">
                    <button class="btn btn-primary" onclick="addSection()">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
            </div>

            <div id="sectionsList"></div>
        </div>

        <!-- Sheikhs Panel -->
        <div id="sheikhs" class="panel">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´ÙŠÙˆØ®</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø´ÙŠØ®</label>
                <div style="display:flex; gap:10px">
                    <input type="text" id="sheikhName" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø´ÙŠØ® Ø§Ù„Ø´Ø¹Ø±Ø§ÙˆÙŠ" style="flex:1">
                    <button class="btn btn-primary" onclick="addSheikh()">â• Ø¥Ø¶Ø§ÙØ©</button>
                </div>
            </div>
            <hr style="margin: 20px 0; border-color: var(--gold)">
            <div id="sheikhsList"></div>
        </div>

        <!-- Lessons Panel -->
        <div id="lessons" class="panel">
            <h2>Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø¶Ø§ÙØ©</h2>
            <div id="lessonsList"></div>
        </div>

        <!-- Add Lesson Panel -->
        <div id="addLesson" class="panel">
            <h2>Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-group">
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</label>
                <input type="text" id="lessonTitle" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø±Ø³ Ø¹Ù† Ù…ØµØ¹Ø¨ Ø¨Ù† Ø¹Ù…ÙŠØ±">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø´ÙŠØ®</label>
                <select id="lessonSheikh"></select>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù… (Ø§Ù„ØªÙØ±ÙŠØº)</label>
                <textarea id="lessonContent" placeholder="Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ ØªÙØ±ÙŠØº Ø§Ù„Ø¯Ø±Ø³..."></textarea>
            </div>
            <div class="form-group"
                style="border: 1px dashed var(--gold); padding: 15px; border-radius: 10px; background: rgba(212,175,55,0.05);">
                <label style="color: var(--gold);">ğŸ”’ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ <small style="color:#999;">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ -
                        Ù„Ù„Ø£Ø¯Ù…Ù† ÙˆØ§Ù„Ù€ AI ÙÙ‚Ø·)</small></label>
                <textarea id="lessonRawSource"
                    placeholder="Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ø´ÙŠØ® Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ø±ÙŠØ©... (Ù„Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹)"
                    style="border-color: var(--gold); min-height: 100px;"></textarea>
                <small style="color:#888; display:block; margin-top:5px;">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù„Ø§ ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆÙ„Ø§ ÙŠØ¯Ø®Ù„ ÙÙŠ
                    Ø§Ù„ØªØ­Ù„ÙŠÙ„ - Ù„Ù„Ø­ÙØ¸ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·</small>
            </div>
            <button class="btn btn-primary" onclick="addLesson()">ğŸ’¾ Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©</button>
            <button class="btn btn-success" onclick="addLesson(true)">ğŸš€ Ù†Ø´Ø± Ù…Ø¨Ø§Ø´Ø±Ø©</button>
        </div>

        <!-- Preview Panel -->
        <div id="preview" class="panel">
            <h2>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
            <div class="form-group">
                <label>Ø§Ø®ØªØ± Ø¯Ø±Ø³ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</label>
                <select id="previewLesson" onchange="showPreview()"></select>
            </div>
            <div id="previewContent"></div>
        </div>
    </div>

    <script>
        // ============ Database (localStorage) ============
        const DB = {
            get: (key) => JSON.parse(localStorage.getItem(key) || '[]'),
            set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),

            // Default sections
            defaultSections: [
                { id: 1, name: 'Ø¢ÙŠØ§Øª Ù‚Ø±Ø¢Ù†ÙŠØ©', icon: 'ğŸ“–', order: 1, isOptional: false },
                { id: 2, name: 'Ø£Ø­Ø§Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠØ©', icon: 'ğŸ•Œ', order: 2, isOptional: false },
                { id: 3, name: 'Ø´Ø®ØµÙŠØ§Øª Ø¥Ø³Ù„Ø§Ù…ÙŠØ©', icon: 'ğŸ‘¤', order: 3, isOptional: false },
                { id: 4, name: 'Ø£Ø­ÙƒØ§Ù… Ø´Ø±Ø¹ÙŠØ©', icon: 'âš–ï¸', order: 4, isOptional: false },
                { id: 5, name: 'ÙÙˆØ§Ø¦Ø¯ ÙˆØ­ÙƒÙ…', icon: 'ğŸ’¡', order: 5, isOptional: false },
                { id: 6, name: 'Ù…Ù„Ø®Øµ Ø§Ù„Ø¯Ø±Ø³', icon: 'ğŸ“', order: 6, isOptional: false },
                { id: 7, name: 'Ø£Ø³Ø¦Ù„Ø©', icon: 'â“', order: 7, isOptional: true },
                { id: 8, name: 'Ø¨ÙˆØ¯ÙƒØ§Ø³Øª', icon: 'ğŸ™ï¸', order: 8, isOptional: true },
                { id: 9, name: 'Ø§Ø³Ø£Ù„ Ø´Ù„Ø¨ÙŠ', icon: 'ğŸ¤–', order: 9, isOptional: false }
            ]
        };

        // ============ Tab Navigation ============
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');

            if (tabId === 'preview') updatePreviewSelect();
        }

        // ============ Sections ============
        function loadSections() {
            const sections = DB.get('sections');
            document.getElementById('sectionsCount').textContent = sections.length;

            document.getElementById('sectionsList').innerHTML = sections.map(s => `
        <div class="list-item">
          <span>${s.icon} ${s.name}</span>
          <span class="badge ${s.isOptional ? 'badge-warning' : 'badge-success'}">
            ${s.isOptional ? 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ' : 'Ø£Ø³Ø§Ø³ÙŠ'}
          </span>
          <button class="btn btn-danger" onclick="deleteSection(${s.id})">Ø­Ø°Ù</button>
        </div>
      `).join('') || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù…</p>';
        }

        function seedSections() {
            DB.set('sections', DB.defaultSections);
            loadSections();
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
        }

        function addSection() {
            const name = document.getElementById('newSectionName').value.trim();
            const icon = document.getElementById('newSectionIcon').value.trim() || 'ğŸ“š';
            if (!name) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…');

            const sections = DB.get('sections');
            const newId = sections.length ? Math.max(...sections.map(s => s.id)) + 1 : 1;
            sections.push({ id: newId, name, icon, order: sections.length + 1, isOptional: true });
            DB.set('sections', sections);

            document.getElementById('newSectionName').value = '';
            document.getElementById('newSectionIcon').value = '';
            loadSections();
        }

        function deleteSection(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ')) return;
            const sections = DB.get('sections').filter(s => s.id !== id);
            DB.set('sections', sections);
            loadSections();
        }

        // ============ Sheikhs ============
        function loadSheikhs() {
            const sheikhs = DB.get('sheikhs');
            document.getElementById('sheikhsCount').textContent = sheikhs.length;

            document.getElementById('sheikhsList').innerHTML = sheikhs.map(s => `
        <div class="list-item">
          <span>ğŸ‘¤ ${s.name}</span>
          <button class="btn btn-danger" onclick="deleteSheikh(${s.id})">Ø­Ø°Ù</button>
        </div>
      `).join('') || '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠÙˆØ®</p>';

            // Update selects
            const select = document.getElementById('lessonSheikh');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´ÙŠØ®</option>' +
                sheikhs.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }

        function addSheikh() {
            const name = document.getElementById('sheikhName').value.trim();
            if (!name) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´ÙŠØ®');

            const sheikhs = DB.get('sheikhs');
            const newId = sheikhs.length ? Math.max(...sheikhs.map(s => s.id)) + 1 : 1;
            sheikhs.push({ id: newId, name });
            DB.set('sheikhs', sheikhs);

            document.getElementById('sheikhName').value = '';
            loadSheikhs();
        }

        function deleteSheikh(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø´ÙŠØ®ØŸ')) return;
            const sheikhs = DB.get('sheikhs').filter(s => s.id !== id);
            DB.set('sheikhs', sheikhs);
            loadSheikhs();
        }

        // ============ Lessons ============
        function loadLessons() {
            const lessons = DB.get('lessons');
            const sheikhs = DB.get('sheikhs');
            document.getElementById('lessonsCount').textContent = lessons.length;

            document.getElementById('lessonsList').innerHTML = lessons.map(l => {
                const sheikh = sheikhs.find(s => s.id === l.sheikhId);
                return `
          <div class="list-item">
            <div>
              <strong>ğŸ“– ${l.title}</strong>
              <small style="color:#999"> - ${sheikh?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</small>
              <span class="badge badge-${l.status === 'published' ? 'success' : 'draft'}">
                ${l.status === 'published' ? 'Ù…Ù†Ø´ÙˆØ±' : 'Ù…Ø³ÙˆØ¯Ø©'}
              </span>
            </div>
            <div>
              <button class="btn btn-success" onclick="publishLesson(${l.id})">Ù†Ø´Ø±</button>
              <button class="btn btn-primary" onclick="editLesson(${l.id})">ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="btn btn-danger" onclick="deleteLesson(${l.id})">Ø­Ø°Ù</button>
            </div>
          </div>
        `;
            }).join('') || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø¨Ø¹Ø¯</p>';
        }

        function addLesson(publish = false) {
            const title = document.getElementById('lessonTitle').value.trim();
            const sheikhId = parseInt(document.getElementById('lessonSheikh').value);
            const rawContent = document.getElementById('lessonContent').value.trim();
            const rawSource = document.getElementById('lessonRawSource').value.trim();

            if (!title) return alert('Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³');
            if (!sheikhId) return alert('Ø§Ø®ØªØ± Ø§Ù„Ø´ÙŠØ®');

            const lessons = DB.get('lessons');
            const newId = lessons.length ? Math.max(...lessons.map(l => l.id)) + 1 : 1;

            const lessonData = {
                id: newId,
                title,
                sheikhId,
                rawContent,
                content: {}, // Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙØ­Ù„Ù„ Ù„Ø§Ø­Ù‚Ø§Ù‹
                status: publish ? 'published' : 'draft',
                createdAt: new Date().toISOString()
            };

            // ğŸ”’ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ - ÙŠØªØ­ÙØ¸ Ø¨Ø³ Ù„Ùˆ ÙÙŠÙ‡ Ù…Ø­ØªÙˆÙ‰
            if (rawSource) {
                lessonData.rawSource = rawSource;
            }

            lessons.push(lessonData);

            DB.set('lessons', lessons);

            document.getElementById('lessonTitle').value = '';
            document.getElementById('lessonContent').value = '';
            document.getElementById('lessonRawSource').value = '';
            loadLessons();
            alert(publish ? 'ğŸš€ ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¯Ø±Ø³' : 'ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³ ÙƒÙ…Ø³ÙˆØ¯Ø©');
        }

        function publishLesson(id) {
            const lessons = DB.get('lessons');
            const lesson = lessons.find(l => l.id === id);
            if (lesson) {
                lesson.status = 'published';
                DB.set('lessons', lessons);
                loadLessons();
            }
        }

        function deleteLesson(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ØŸ')) return;
            const lessons = DB.get('lessons').filter(l => l.id !== id);
            DB.set('lessons', lessons);
            loadLessons();
        }

        function editLesson(id) {
            const lessons = DB.get('lessons');
            const lesson = lessons.find(l => l.id === id);
            if (lesson) {
                document.getElementById('lessonTitle').value = lesson.title;
                document.getElementById('lessonSheikh').value = lesson.sheikhId;
                document.getElementById('lessonContent').value = lesson.rawContent;
                showTab('addLesson');
                // Ø­Ø°Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…
                deleteLesson(id);
            }
        }

        // ============ Preview ============
        function updatePreviewSelect() {
            const lessons = DB.get('lessons').filter(l => l.status === 'published');
            const sheikhs = DB.get('sheikhs');

            document.getElementById('previewLesson').innerHTML =
                '<option value="">Ø§Ø®ØªØ± Ø¯Ø±Ø³</option>' +
                lessons.map(l => {
                    const sheikh = sheikhs.find(s => s.id === l.sheikhId);
                    return `<option value="${l.id}">${l.title} - ${sheikh?.name || ''}</option>`;
                }).join('');
        }

        function showPreview() {
            const lessonId = parseInt(document.getElementById('previewLesson').value);
            if (!lessonId) {
                document.getElementById('previewContent').innerHTML = '';
                return;
            }

            const lessons = DB.get('lessons');
            const sections = DB.get('sections');
            const sheikhs = DB.get('sheikhs');
            const lesson = lessons.find(l => l.id === lessonId);
            const sheikh = sheikhs.find(s => s.id === lesson?.sheikhId);

            if (!lesson) return;

            document.getElementById('previewContent').innerHTML = `
        <div style="text-align:center; margin-bottom:30px">
          <h2 style="color:var(--gold)">${lesson.title}</h2>
          <p style="color:#999">ğŸ‘¤ ${sheikh?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
        </div>
        
        ${sections.map(section => `
          <div class="section-card">
            <h4>${section.icon} ${section.name}</h4>
            <div class="content-box">
              ${lesson.content[section.id] || 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¹Ø¯...'}
            </div>
          </div>
        `).join('')}
      `;
        }

        // ============ Initialize ============
        function init() {
            loadSections();
            loadSheikhs();
            loadLessons();
        }

        init();
    </script>
</body>

</html>