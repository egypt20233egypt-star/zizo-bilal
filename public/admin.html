<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ø²ÙŠØ²Ùˆ ÙˆØ¨Ù„Ø§Ù„</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #D4AF37;
      --dark: #1a1a2e;
      --darker: #16213e;
      --burgundy: #722F37;
      --text: #f5f5f5;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: var(--dark);
      color: var(--text);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, var(--darker), var(--dark));
      padding: 20px;
      border-bottom: 2px solid var(--gold);
      margin-bottom: 30px;
    }

    header h1 {
      color: var(--gold);
      font-size: 1.8rem;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 12px 24px;
      background: var(--darker);
      border: 1px solid var(--gold);
      color: var(--gold);
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .tab:hover, .tab.active {
      background: var(--gold);
      color: var(--dark);
    }

    .panel {
      display: none;
      background: var(--darker);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }

    .panel.active {
      display: block;
    }

    .panel h2 {
      color: var(--gold);
      margin-bottom: 20px;
      font-size: 1.4rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: var(--gold);
    }

    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--gold);
      border-radius: 8px;
      background: var(--dark);
      color: var(--text);
      font-family: inherit;
    }

    textarea {
      min-height: 150px;
      resize: vertical;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-primary {
      background: var(--gold);
      color: var(--dark);
    }

    .btn-primary:hover {
      background: #e6c547;
    }

    .btn-danger {
      background: var(--burgundy);
      color: white;
    }

    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: var(--dark);
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid rgba(212, 175, 55, 0.1);
    }

    .list-item span {
      font-size: 1.1rem;
    }

    .actions {
      display: flex;
      gap: 10px;
    }

    .badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-right: 10px;
    }

    .badge-success { background: #2ecc71; color: white; }
    .badge-warning { background: #f39c12; color: white; }
    .badge-draft { background: #95a5a6; color: white; }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--darker), var(--dark));
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid var(--gold);
    }

    .stat-card h3 {
      font-size: 2.5rem;
      color: var(--gold);
    }

    .stat-card p {
      color: #999;
    }

    #loginForm {
      max-width: 400px;
      margin: 100px auto;
      padding: 40px;
      background: var(--darker);
      border-radius: 12px;
      border: 1px solid var(--gold);
    }

    #loginForm h2 {
      text-align: center;
      color: var(--gold);
      margin-bottom: 30px;
    }

    .hidden { display: none !important; }

    .message {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .message-success { background: rgba(46, 204, 113, 0.2); border: 1px solid #2ecc71; }
    .message-error { background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c; }
  </style>
</head>
<body>

  <!-- Login Form -->
  <div id="loginForm">
    <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <div class="form-group">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
      <input type="text" id="username" value="admin">
    </div>
    <div class="form-group">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input type="password" id="password" value="admin123">
    </div>
    <button class="btn btn-primary" style="width:100%" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="hidden">
    <header>
      <div class="container">
        <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ù…Ù†ØµØ© Ø²ÙŠØ²Ùˆ ÙˆØ¨Ù„Ø§Ù„</h1>
      </div>
    </header>

    <div class="container">
      <div class="stats">
        <div class="stat-card">
          <h3 id="sectionsCount">0</h3>
          <p>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</p>
        </div>
        <div class="stat-card">
          <h3 id="sheikhsCount">0</h3>
          <p>Ø§Ù„Ø´ÙŠÙˆØ®</p>
        </div>
        <div class="stat-card">
          <h3 id="lessonsCount">0</h3>
          <p>Ø§Ù„Ø¯Ø±ÙˆØ³</p>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showTab('sections')">ğŸ“š Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
        <button class="tab" onclick="showTab('sheikhs')">ğŸ‘¤ Ø§Ù„Ø´ÙŠÙˆØ®</button>
        <button class="tab" onclick="showTab('lessons')">ğŸ“– Ø§Ù„Ø¯Ø±ÙˆØ³</button>
        <button class="tab" onclick="showTab('addLesson')">â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³</button>
      </div>

      <!-- Sections Panel -->
      <div id="sections" class="panel active">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h2>
        <button class="btn btn-primary" onclick="seedSections()" style="margin-bottom:20px">ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
        <div id="sectionsList"></div>
      </div>

      <!-- Sheikhs Panel -->
      <div id="sheikhs" class="panel">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´ÙŠÙˆØ®</h2>
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ø´ÙŠØ®</label>
          <input type="text" id="sheikhName" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø´ÙŠØ® Ø§Ù„Ø´Ø¹Ø±Ø§ÙˆÙŠ">
        </div>
        <button class="btn btn-primary" onclick="addSheikh()">â• Ø¥Ø¶Ø§ÙØ© Ø´ÙŠØ®</button>
        <hr style="margin: 20px 0; border-color: var(--gold)">
        <div id="sheikhsList"></div>
      </div>

      <!-- Lessons Panel -->
      <div id="lessons" class="panel">
        <h2>Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø¶Ø§ÙØ©</h2>
        <div id="lessonsList"></div>
      </div>

      <!-- Add Lesson Panel -->
      <div id="addLesson" class="panel">
        <h2>Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h2>
        <div class="form-group">
          <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</label>
          <input type="text" id="lessonTitle" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø±Ø³ Ø¹Ù† Ù…ØµØ¹Ø¨ Ø¨Ù† Ø¹Ù…ÙŠØ±">
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø´ÙŠØ®</label>
          <select id="lessonSheikh"></select>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù… (Ø§Ù„ØªÙØ±ÙŠØº)</label>
          <textarea id="lessonContent" placeholder="Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ ØªÙØ±ÙŠØº Ø§Ù„Ø¯Ø±Ø³..."></textarea>
        </div>
        <button class="btn btn-primary" onclick="addLesson()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³</button>
      </div>
    </div>
  </div>

  <script>
    const API = '';
    let token = localStorage.getItem('token');

    // Check if logged in
    if (token) {
      showAdmin();
    }

    async function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      try {
        const res = await fetch(`${API}/api/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        
        if (data.token) {
          localStorage.setItem('token', data.token);
          token = data.token;
          showAdmin();
        } else {
          alert('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
        }
      } catch (err) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
      }
    }

    function showAdmin() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('adminPanel').classList.remove('hidden');
      loadData();
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    async function loadData() {
      await loadSections();
      await loadSheikhs();
      await loadLessons();
    }

    async function loadSections() {
      const res = await fetch(`${API}/api/sections`);
      const sections = await res.json();
      document.getElementById('sectionsCount').textContent = sections.length;
      
      const list = document.getElementById('sectionsList');
      list.innerHTML = sections.map(s => `
        <div class="list-item">
          <span>${s.icon} ${s.nameAr}</span>
          <span class="badge ${s.isOptional ? 'badge-warning' : 'badge-success'}">
            ${s.isOptional ? 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ' : 'Ø£Ø³Ø§Ø³ÙŠ'}
          </span>
        </div>
      `).join('');
    }

    async function seedSections() {
      await fetch(`${API}/api/sections/seed`, { method: 'POST' });
      await loadSections();
      alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© âœ…');
    }

    async function loadSheikhs() {
      const res = await fetch(`${API}/api/sheikhs`);
      const sheikhs = await res.json();
      document.getElementById('sheikhsCount').textContent = sheikhs.length;
      
      const list = document.getElementById('sheikhsList');
      list.innerHTML = sheikhs.map(s => `
        <div class="list-item">
          <span>ğŸ‘¤ ${s.name}</span>
          <button class="btn btn-danger" onclick="deleteSheikh('${s._id}')">Ø­Ø°Ù</button>
        </div>
      `).join('');

      // Update sheikh select
      const select = document.getElementById('lessonSheikh');
      select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´ÙŠØ®</option>' + 
        sheikhs.map(s => `<option value="${s._id}">${s.name}</option>`).join('');
    }

    async function addSheikh() {
      const name = document.getElementById('sheikhName').value;
      if (!name) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´ÙŠØ®');

      await fetch(`${API}/api/sheikhs`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      });
      document.getElementById('sheikhName').value = '';
      await loadSheikhs();
    }

    async function deleteSheikh(id) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø´ÙŠØ®ØŸ')) return;
      await fetch(`${API}/api/sheikhs/${id}`, { method: 'DELETE' });
      await loadSheikhs();
    }

    async function loadLessons() {
      const res = await fetch(`${API}/api/lessons`);
      const lessons = await res.json();
      document.getElementById('lessonsCount').textContent = lessons.length;
      
      const list = document.getElementById('lessonsList');
      list.innerHTML = lessons.length ? lessons.map(l => `
        <div class="list-item">
          <div>
            <span>ğŸ“– ${l.title}</span>
            <span class="badge badge-${l.status === 'published' ? 'success' : 'draft'}">
              ${l.status === 'published' ? 'Ù…Ù†Ø´ÙˆØ±' : 'Ù…Ø³ÙˆØ¯Ø©'}
            </span>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="publishLesson('${l._id}')">Ù†Ø´Ø±</button>
            <button class="btn btn-danger" onclick="deleteLesson('${l._id}')">Ø­Ø°Ù</button>
          </div>
        </div>
      `).join('') : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø¨Ø¹Ø¯</p>';
    }

    async function addLesson() {
      const title = document.getElementById('lessonTitle').value;
      const sheikh = document.getElementById('lessonSheikh').value;
      const rawContent = document.getElementById('lessonContent').value;

      if (!title || !sheikh) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');

      await fetch(`${API}/api/lessons`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, sheikh, rawContent })
      });

      document.getElementById('lessonTitle').value = '';
      document.getElementById('lessonContent').value = '';
      await loadLessons();
      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³ âœ…');
    }

    async function publishLesson(id) {
      await fetch(`${API}/api/lessons/${id}/publish`, { method: 'PUT' });
      await loadLessons();
    }

    async function deleteLesson(id) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ØŸ')) return;
      await fetch(`${API}/api/lessons/${id}`, { method: 'DELETE' });
      await loadLessons();
    }
  </script>
</body>
</html>
